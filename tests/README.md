# Tests ç›®å½•ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£ä»‹ç» `tests/` æ–‡ä»¶å¤¹çš„ç»„ç»‡ç»“æ„å’Œå„æ¨¡å—åŠŸèƒ½ã€‚

## ğŸ“ ç›®å½•æ¦‚è§ˆ

```
tests/
â”œâ”€â”€ __init__.py                    # æµ‹è¯•åŒ…åˆå§‹åŒ–
â”œâ”€â”€ conftest.py                    # Pytest å…¨å±€é…ç½®å’Œå…±äº« fixtures
â”œâ”€â”€ test_owasp_agentic.py          # OWASP Agentic Top 10 è§„åˆ™è¦†ç›–æµ‹è¯•
â”‚
â”œâ”€â”€ fixtures/                      # æµ‹è¯•ç”¨ä¾‹æ ·æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ asi-01-goal-hijack/        # ASI-01: ç›®æ ‡åŠ«æŒæ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-02-tool-misuse/        # ASI-02: å·¥å…·æ»¥ç”¨æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-03-privilege-abuse/    # ASI-03: æƒé™æ»¥ç”¨æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-04-supply-chain/       # ASI-04: ä¾›åº”é“¾æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-05-rce/                # ASI-05: ä»£ç æ‰§è¡Œæ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-06-memory-poisoning/   # ASI-06: å†…å­˜æŠ•æ¯’æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-07-inter-agent/        # ASI-07: ä»£ç†é—´é€šä¿¡æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-08-cascading/          # ASI-08: çº§è”æ•…éšœæ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-09-trust/              # ASI-09: ä¿¡ä»»åˆ©ç”¨æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ asi-10-rogue/              # ASI-10: æ¶æ„ä»£ç†æ¼æ´æ ·æœ¬
â”‚   â”œâ”€â”€ benign/                    # è‰¯æ€§ä»£ç æ ·æœ¬ï¼ˆç”¨äºè¯¯æŠ¥æµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ vulnerable_agents/         # å®Œæ•´æ¼æ´ä»£ç†ç¤ºä¾‹
â”‚   â”œâ”€â”€ safe_agents/               # å®‰å…¨ä»£ç†ç¤ºä¾‹
â”‚   â””â”€â”€ mcp_configs/               # MCP é…ç½®æµ‹è¯•æ ·æœ¬
â”‚
â”œâ”€â”€ ground_truth/                  # åŸºå‡†æµ‹è¯•æ•°æ®é›†
â”‚   â”œâ”€â”€ schema.yaml                # Ground Truth æ•°æ®æ ¼å¼å®šä¹‰
â”‚   â””â”€â”€ labeled_samples.yaml       # æ ‡æ³¨çš„æ¼æ´æ ·æœ¬ï¼ˆv2.1ï¼Œ42 æ ·æœ¬ï¼Œ198 æ ‡æ³¨ï¼‰
â”‚
â”œâ”€â”€ benchmark/                     # æ€§èƒ½ä¸ç²¾åº¦åŸºå‡†æµ‹è¯•
â”‚   â”œâ”€â”€ precision_recall.py        # ç²¾ç¡®ç‡/å¬å›ç‡/F1 è¯„ä¼°è„šæœ¬
â”‚   â”œâ”€â”€ performance_test.py        # æ€§èƒ½åŸºå‡†æµ‹è¯•
â”‚   â”œâ”€â”€ asi_coverage.py            # ASI ç±»åˆ«è¦†ç›–åº¦åˆ†æ
â”‚   â”œâ”€â”€ atlas_report.py            # ATLAS æ˜ å°„æŠ¥å‘Šç”Ÿæˆ
â”‚   â”œâ”€â”€ run_benchmark.py           # åŸºå‡†æµ‹è¯•è¿è¡Œå™¨
â”‚   â”œâ”€â”€ benchmark_config.yaml      # åŸºå‡†æµ‹è¯•é…ç½®ï¼ˆ11 ä¸ªç›®æ ‡é¡¹ç›®ï¼‰
â”‚   â”œâ”€â”€ quality_gates.yaml         # è´¨é‡é—¨é™é…ç½®
â”‚   â””â”€â”€ fixtures/                  # åŸºå‡†æµ‹è¯•ä¸“ç”¨ fixtures
â”‚
â”œâ”€â”€ test_scanners/                 # æ‰«æå™¨å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_python_scanner.py     # Python ä»£ç æ‰«æå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_python_scanner_ext.py # Python æ‰«æå™¨æ‰©å±•æµ‹è¯•
â”‚   â”œâ”€â”€ test_langchain_rules_v030.py # LangChain è§„åˆ™æµ‹è¯• (v0.3.0)
â”‚   â”œâ”€â”€ test_mcp_scanner.py        # MCP é…ç½®æ‰«æå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_mcp_scanner_v030.py   # MCP æ‰«æå™¨æµ‹è¯• (v0.3.0)
â”‚   â”œâ”€â”€ test_mcp_config_scanner_ext.py # MCP é…ç½®æ‰«æå™¨æ‰©å±•æµ‹è¯•
â”‚   â”œâ”€â”€ test_mcp_inspector.py      # MCP æ£€æŸ¥å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_config_scanner.py     # é…ç½®æ–‡ä»¶æ‰«æå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_secret_scanner.py     # å¯†é’¥æ‰«æå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_asi_coverage_v030.py  # ASI è¦†ç›–åº¦æµ‹è¯• (v0.3.0)
â”‚   â””â”€â”€ test_memory_poisoning_v030.py # å†…å­˜æŠ•æ¯’æµ‹è¯• (v0.3.0)
â”‚
â”œâ”€â”€ test_rules/                    # è§„åˆ™å¼•æ“æµ‹è¯•
â”‚   â””â”€â”€ test_engine.py             # è§„åˆ™å¼•æ“æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
â”‚
â”œâ”€â”€ test_cli/                      # CLI å‘½ä»¤æµ‹è¯•
â”‚   â”œâ”€â”€ test_scan_command.py       # scan å‘½ä»¤æµ‹è¯•
â”‚   â”œâ”€â”€ test_inspect_command.py    # inspect å‘½ä»¤æµ‹è¯•
â”‚   â”œâ”€â”€ test_init_command.py       # init å‘½ä»¤æµ‹è¯•
â”‚   â”œâ”€â”€ test_formatters.py         # è¾“å‡ºæ ¼å¼åŒ–æµ‹è¯•
â”‚   â””â”€â”€ test_inspect_render.py     # inspect æ¸²æŸ“æµ‹è¯•
â”‚
â”œâ”€â”€ test_config/                   # é…ç½®åŠŸèƒ½æµ‹è¯•
â”‚   â””â”€â”€ test_ignore.py             # å¿½ç•¥è§„åˆ™æµ‹è¯•
â”‚
â”œâ”€â”€ test_models/                   # æ•°æ®æ¨¡å‹æµ‹è¯•
â”‚   â””â”€â”€ test_finding.py            # Finding æ¨¡å‹æµ‹è¯•
â”‚
â”œâ”€â”€ test_utils/                    # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ test_compat.py             # å…¼å®¹æ€§æµ‹è¯•
â”‚   â”œâ”€â”€ test_compat_extended.py    # æ‰©å±•å…¼å®¹æ€§æµ‹è¯•
â”‚   â””â”€â”€ test_mcp_client.py         # MCP å®¢æˆ·ç«¯æµ‹è¯•
â”‚
â”œâ”€â”€ BENCHMARK_UPGRADE_PROMPT.md    # åŸºå‡†æµ‹è¯•å‡çº§æŒ‡å—
â””â”€â”€ improve.md                     # æµ‹è¯•æ”¹è¿›æ–‡æ¡£
```

---

## ğŸ“‚ æ ¸å¿ƒç›®å½•è¯¦è§£

### 1. `fixtures/` - æµ‹è¯•æ ·æœ¬æ–‡ä»¶

åŒ…å«æŒ‰ OWASP Agentic Top 10 (ASI) åˆ†ç±»ç»„ç»‡çš„æ¼æ´æ ·æœ¬å’Œå®‰å…¨ä»£ç æ ·æœ¬ã€‚

#### æ¼æ´æ ·æœ¬ç»“æ„
- **ç›´æ¥æ¼æ´** (`direct/`): æ˜æ˜¾çš„æ¼æ´å®ç°
- **é—´æ¥æ¼æ´** (`indirect/`): é€šè¿‡ä¾èµ–æˆ–é—´æ¥è°ƒç”¨è§¦å‘çš„æ¼æ´
- **ç»•è¿‡æŠ€æœ¯** (`bypass/`): ç»•è¿‡å®‰å…¨æ§åˆ¶çš„ç¤ºä¾‹
- **è¾¹ç•Œæƒ…å†µ** (`edge_cases/`): ç‰¹æ®Šåœºæ™¯å’Œè¾¹ç•Œæ¡ä»¶

#### è‰¯æ€§æ ·æœ¬ (`benign/`)
- `validated/`: åŒ…å«è¾“å…¥éªŒè¯çš„å®‰å…¨ä»£ç 
- `sandboxed/`: ä½¿ç”¨æ²™ç®±éš”ç¦»çš„ä»£ç 
- `hardened/`: åŠ å›ºçš„å®‰å…¨å®ç°

**å½“å‰çŠ¶æ€**: 42 ä¸ªæ ·æœ¬æ–‡ä»¶ï¼ˆ33 ä¸ªæ¼æ´ + 9 ä¸ªè‰¯æ€§ï¼‰

### 2. `ground_truth/` - åŸºå‡†æ•°æ®é›†

ç”¨äºè¯„ä¼°æ‰«æå™¨ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„æ ‡æ³¨æ•°æ®é›†ã€‚

#### `labeled_samples.yaml`
- **ç‰ˆæœ¬**: v2.1
- **æ ·æœ¬æ•°**: 42 ä¸ªæ–‡ä»¶
- **æ ‡æ³¨æ•°**: 198 ä¸ªæ¼æ´æ ‡æ³¨
- **æ ¼å¼**: YAMLï¼Œæ¯ä¸ªæ ·æœ¬åŒ…å«æ–‡ä»¶è·¯å¾„å’Œæ¼æ´åˆ—è¡¨ï¼ˆè¡Œå·ã€è§„åˆ™IDã€OWASP IDç­‰ï¼‰

#### `schema.yaml`
å®šä¹‰ ground truth æ•°æ®æ ¼å¼è§„èŒƒï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

**å½“å‰æ€§èƒ½æŒ‡æ ‡** (æ›´æ–°å):
- Precision: **98.51%** âœ… (ç›®æ ‡: â‰¥90%)
- Recall: **100.00%** âœ… (ç›®æ ‡: â‰¥85%)
- F1-Score: **99.25%** âœ… (ç›®æ ‡: â‰¥0.87)
- FP Rate: **1.49%** âœ… (ç›®æ ‡: â‰¤5%)
- å‰©ä½™è¯¯æŠ¥: 3 ä¸ªï¼ˆè§„åˆ™ç²¾åº¦é—®é¢˜ï¼Œéæ ‡æ³¨é”™è¯¯ï¼‰

### 3. `benchmark/` - åŸºå‡†æµ‹è¯•å¥—ä»¶

ç”¨äºè¯„ä¼°æ‰«æå™¨æ€§èƒ½å’Œå‡†ç¡®æ€§çš„ç»¼åˆæµ‹è¯•å¥—ä»¶ã€‚

#### æ ¸å¿ƒè„šæœ¬

**`precision_recall.py`**
- è®¡ç®—ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1 åˆ†æ•°
- ç”Ÿæˆè¯¦ç»†çš„è¯¯æŠ¥/æ¼æŠ¥æŠ¥å‘Š
- æ”¯æŒè‡ªå®šä¹‰ ground truth è·¯å¾„

**`performance_test.py`**
- æµ‹é‡æ‰«ææ€§èƒ½ï¼ˆé€Ÿåº¦ã€å†…å­˜ï¼‰
- æ”¯æŒå¤šé¡¹ç›®å¯¹æ¯”
- ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

**`asi_coverage.py`**
- åˆ†æ ASI-01 åˆ° ASI-10 çš„è¦†ç›–åº¦
- ç”Ÿæˆç±»åˆ«åˆ†å¸ƒæŠ¥å‘Š
- è¯†åˆ«è¦†ç›–ç›²ç‚¹

**`atlas_report.py`**
- ç”Ÿæˆ ATLAS æ˜ å°„æŠ¥å‘Š
- å…³è”è§„åˆ™åˆ° ATLAS åˆ†ç±»

**`run_benchmark.py`**
- ç»Ÿä¸€è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•
- ç”Ÿæˆç»¼åˆæŠ¥å‘Š

#### é…ç½®æ–‡ä»¶

**`benchmark_config.yaml`**
å®šä¹‰ 11 ä¸ªåŸºå‡†æµ‹è¯•ç›®æ ‡ï¼š
- **T1-T2**: æ•…æ„æ¼æ´é¡¹ç›®ï¼ˆdamn-vulnerable-llm-agent ç­‰ï¼‰
- **T3-T9**: çœŸå®æ¡†æ¶ï¼ˆLangChainã€OpenAI Agentsã€CrewAI ç­‰ï¼‰
- **T10**: æœ¬åœ° MCP é…ç½®æµ‹è¯•
- **T11**: Streamlit åº”ç”¨ç¤ºä¾‹

**`quality_gates.yaml`**
å®šä¹‰è´¨é‡é—¨é™ï¼š
- å‘å¸ƒæ ‡å‡†ï¼šPrecision â‰¥90%, Recall â‰¥85%, F1 â‰¥0.87, FP Rate â‰¤5%
- å›å½’æ£€æµ‹é˜ˆå€¼
- æ¯ä¸ª ASI ç±»åˆ«çš„æœ€å°è¦æ±‚

### 4. `test_scanners/` - æ‰«æå™¨æµ‹è¯•

é’ˆå¯¹ä¸åŒæ‰«æå™¨çš„å•å…ƒæµ‹è¯•ï¼š

- **Python æ‰«æå™¨**: æ£€æµ‹ Python ä»£ç ä¸­çš„æ¼æ´æ¨¡å¼
- **MCP æ‰«æå™¨**: æ£€æµ‹ MCP é…ç½®ä¸­çš„å®‰å…¨é—®é¢˜
- **é…ç½®æ‰«æå™¨**: æ£€æµ‹é…ç½®æ–‡ä»¶ä¸­çš„æ¼æ´
- **å¯†é’¥æ‰«æå™¨**: æ£€æµ‹ç¡¬ç¼–ç å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯
- **LangChain è§„åˆ™**: é’ˆå¯¹ LangChain æ¡†æ¶çš„ç‰¹æ®Šè§„åˆ™
- **å†…å­˜æŠ•æ¯’**: ASI-06 ç›¸å…³æ£€æµ‹

### 5. `test_rules/` - è§„åˆ™å¼•æ“æµ‹è¯•

æµ‹è¯•è§„åˆ™å¼•æ“çš„æ ¸å¿ƒåŠŸèƒ½ï¼š
- è§„åˆ™åŠ è½½å’Œè§£æ
- è§„åˆ™åŒ¹é…é€»è¾‘
- è§„åˆ™ä¼˜å…ˆçº§å’Œå†²çªå¤„ç†

### 6. `test_cli/` - å‘½ä»¤è¡Œæµ‹è¯•

æµ‹è¯• CLI å‘½ä»¤çš„åŠŸèƒ½ï¼š
- `scan`: æ‰«æå‘½ä»¤
- `inspect`: æ£€æŸ¥å‘½ä»¤
- `init`: åˆå§‹åŒ–å‘½ä»¤
- è¾“å‡ºæ ¼å¼åŒ–ï¼ˆJSONã€YAMLã€Markdown ç­‰ï¼‰

### 7. `test_config/` - é…ç½®æµ‹è¯•

æµ‹è¯•é…ç½®åŠŸèƒ½ï¼š
- å¿½ç•¥è§„åˆ™ï¼ˆ`.agent-audit.yaml`ï¼‰
- é…ç½®æ–‡ä»¶çš„è§£æå’Œåº”ç”¨

### 8. `test_models/` - æ•°æ®æ¨¡å‹æµ‹è¯•

æµ‹è¯•æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼š
- `Finding` æ¨¡å‹çš„ç»“æ„å’ŒéªŒè¯
- æ¨¡å‹åºåˆ—åŒ–/ååºåˆ—åŒ–

### 9. `test_utils/` - å·¥å…·å‡½æ•°æµ‹è¯•

æµ‹è¯•å·¥å…·å‡½æ•°å’Œå…¼å®¹æ€§ï¼š
- å…¼å®¹æ€§å¤„ç†
- MCP å®¢æˆ·ç«¯åŠŸèƒ½

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
pytest tests/
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
```bash
# æ‰«æå™¨æµ‹è¯•
pytest tests/test_scanners/

# CLI æµ‹è¯•
pytest tests/test_cli/

# è§„åˆ™å¼•æ“æµ‹è¯•
pytest tests/test_rules/
```

### è¿è¡ŒåŸºå‡†æµ‹è¯•
```bash
# ç²¾ç¡®ç‡/å¬å›ç‡è¯„ä¼°
python tests/benchmark/precision_recall.py

# æ€§èƒ½æµ‹è¯•
python tests/benchmark/performance_test.py

# å®Œæ•´åŸºå‡†æµ‹è¯•å¥—ä»¶
python tests/benchmark/run_benchmark.py
```

### è¿è¡Œ OWASP è¦†ç›–æµ‹è¯•
```bash
pytest tests/test_owasp_agentic.py -v
```

---

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•æ–‡ä»¶æ•°**: ~30+ ä¸ªæµ‹è¯•æ¨¡å—
- **æµ‹è¯•æ ·æœ¬æ•°**: 42 ä¸ªï¼ˆ33 æ¼æ´ + 9 è‰¯æ€§ï¼‰
- **æ¼æ´æ ‡æ³¨æ•°**: 198 ä¸ª
- **åŸºå‡†æµ‹è¯•ç›®æ ‡**: 11 ä¸ªé¡¹ç›®
- **OWASP ASI è¦†ç›–**: 10/10 ç±»åˆ«

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- `BENCHMARK_UPGRADE_PROMPT.md`: åŸºå‡†æµ‹è¯•å‡çº§æŒ‡å—
- `improve.md`: æµ‹è¯•æ”¹è¿›å»ºè®®å’Œè®¡åˆ’
- `ground_truth/schema.yaml`: Ground Truth æ•°æ®æ ¼å¼è§„èŒƒ

---

## ğŸ”„ æ›´æ–°å†å²

- **v2.1** (2026-02-04): Ground Truth æ›´æ–°ï¼Œæ·»åŠ  87 ä¸ªæ–°æ ‡æ³¨ï¼Œè¾¾åˆ° 98.51% Precision
- **v2.0**: åˆå§‹ Ground Truth æ•°æ®é›†ï¼ˆ39 æ ·æœ¬ï¼Œ111 æ ‡æ³¨ï¼‰
- **v1.0**: åŸºå‡†æµ‹è¯•åŸºç¡€è®¾æ–½å»ºç«‹

---

## ğŸ¯ è´¨é‡ç›®æ ‡

å½“å‰çŠ¶æ€ï¼ˆv2.1ï¼‰:
- âœ… Precision: 98.51% (ç›®æ ‡: â‰¥90%)
- âœ… Recall: 100.00% (ç›®æ ‡: â‰¥85%)
- âœ… F1-Score: 99.25% (ç›®æ ‡: â‰¥0.87)
- âœ… FP Rate: 1.49% (ç›®æ ‡: â‰¤5%)

å‰©ä½™æ”¹è¿›ç©ºé—´:
- 3 ä¸ªè¯¯æŠ¥éœ€è¦è§„åˆ™é€»è¾‘ä¼˜åŒ–ï¼ˆAGENT-026, AGENT-034ï¼‰
